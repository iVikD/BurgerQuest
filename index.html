<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BurgerQuest & Dining Ledger</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; background: #f4f4f9; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .card { border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: #fafafa; }
        .burger-section { background: #fff3e0; border-color: #ffb74d; }
        img { max-width: 100px; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçî BurgerQuest & Dining Ledger</h1>

        <section class="card burger-section">
            <h2>The Burger Counter</h2>
            <div class="stats-grid">
                <div>
                    <p>Total Burgers Eaten: <strong id="burger-count">0</strong></p>
                    <canvas id="burgerChart"></canvas>
                </div>
                <div>
                    <h3>Top Rated Burgers</h3>
                    <ul id="top-burgers"></ul>
                </div>
            </div>
        </section>

        <section>
            <h2>General Dining History</h2>
            <p>Total Meals Logged: <span id="total-meals">0</span></p>
            <table id="meals-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Restaurant</th>
                        <th>Rating</th>
                        <th>Price</th>
                        <th>Category</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>
    </div>

    <script>
        async function loadDashboard() {
            const response = await fetch('./data/meals.json');
            const data = await response.json();

            // 1. Stats Calculation
            const burgers = data.filter(m => m.is_burger || m.category === 'burger');
            document.getElementById('burger-count').innerText = burgers.length;
            document.getElementById('total-meals').innerText = data.length;

            // 2. Burger Monthly Chart
            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            const burgerCounts = new Array(12).fill(0);
            
            burgers.forEach(b => {
                const month = new Date(b.timestamp).getMonth();
                burgerCounts[month]++;
            });

            new Chart(document.getElementById('burgerChart'), {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{ label: 'Burgers per Month', data: burgerCounts, backgroundColor: '#ff9800' }]
                }
            });

            // 3. Top Burgers List
            const topBurgers = [...burgers].sort((a, b) => b.rating - a.rating).slice(0, 3);
            document.getElementById('top-burgers').innerHTML = topBurgers
                .map(b => `<li><strong>${b.name}</strong> - ${b.rating}/10</li>`).join('');

            // 4. Meals Table
            const tableBody = document.querySelector('#meals-table tbody');
            data.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).forEach(m => {
                const row = `<tr>
                    <td>${new Date(m.timestamp).toLocaleDateString()}</td>
                    <td>${m.name}</td>
                    <td>${m.rating}/10</td>
                    <td>${m.price}‚Ç¨</td>
                    <td>${m.category}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        }
        loadDashboard();
    </script>
</body>
</html>